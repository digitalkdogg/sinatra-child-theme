class Give{constructor(){var i=this;this.vars={templates:{}},this.stripe_utils={},this.fn={init:function(){0<$("#stripevars").val().length&&(i.vars=JSON.parse($("#stripevars").val()),i.vars.rest_url=sinatra_vars.ajaxurl),i.fn.stripe()},stripe_utils:{generate_stripe_data:function(){i.stripe.ownerInfo={},i.stripe.ownerInfo.owner={},i.stripe.ownerInfo.owner.address={},i.stripe.ownerInfo.owner.name=$(i.stripe.stripeWrapper).find("input#names").val(),i.stripe.ownerInfo.owner.address.line1=$(i.stripe.stripeWrapper).find("input#addresss").val(),i.stripe.ownerInfo.owner.address.city=$(i.stripe.stripeWrapper).find("input#citys").val(),i.stripe.ownerInfo.owner.address.state=$(i.stripe.stripeWrapper).find("input#states").val(),i.stripe.ownerInfo.owner.address.postal_code=$(i.stripe.stripeWrapper).find("input#zips").val(),i.stripe.ownerInfo.owner.email=$(i.stripe.stripeWrapper).find("input#emails").val()},clear_error:function(){$(i.stripe.stripeWrapper).find(".card-errors").each(function(){$(this).html("")}),$(i.stripe.stripeWrapper).find(".error").each(function(){$(this).removeClass("error")})},check_userinfo:function(){var e=!0;return i.fn.stripe_utils.clear_error(),$("input.info.required").each(function(){0==$(this).val().length&&($(this).addClass("error"),$("#form-wrapper .card-errors").append($(this).attr("data-msg")+"<br />"),e=!1)}),0!=e},check_goodtogo:function(){return null==i.stripe.ownerInfo?(i.stripe.valid=!1,$("#confirm-section .card-errors").html("Please go to the info section and enter your info before confirming your donation"),!1):i.stripe.ownerInfo.owner.name.length<=0?(i.stripe.valid=!1,$("#confirm-section .card-errors").html("Please Enter a name on the info section before confirming your donation"),!1):i.stripe.ownerInfo.owner.email.length<=0?(i.stripe.valid=!1,$("#confirm-section .card-errors").html("Please Enter an email on the info section before confirming your donation"),!1):0!=i.stripe.amount&&"0"!=i.stripe.amount||(i.stripe.valid=!1,$("#confirm-section .card-errors").html("Please Enter an amount on the amount section"),!1)},nav_to_next:function(e){$(i.stripe.stripeWrapper).find(".tab").each(function(){$(this).removeClass("active")}),$(".tab-section").each(function(){$(this).addClass("hide")});var t=$(e).attr("data-next"),e=$(e).attr("data-tab");$("#"+t).removeClass("hide"),$("#"+e+".tab").addClass("active"),$("#"+e+".tab").removeClass("disabled")},check_amount:function(){return null==i.stripe.amount||0==i.stripe.amount||"0"==i.stripe.amount?(i.stripe.valid=!1,$("#amount-section .card-errors").html("Please Enter an amount on the amount section"),$("#amount-section .amount-wrap").addClass("error"),$("#confirm-section .card-errors").html("Please Enter an amount on the amount section"),!1):!(0<=i.stripe.amount.indexOf("."))||(i.stripe.valid=!1,$("#amount-section .card-errors").html("Please Enter a WHOLE dollar amount"),$("#amount-section .amount-wrap").addClass("error"),$("#confirm-section .card-errors").html("Please Enter a WHOLE dollar amount"),!1)},get_payment_intents:function(e){$.ajax({url:"index.php/wp-json/stripe/v1/create_intent",type:"POST",data:{action:"get_stripe_intent",amount:parseInt(e+"00"),type:i.stripe.mode,name:i.stripe.ownerInfo.owner.name,email:i.stripe.ownerInfo.owner.email,address:{line1:i.stripe.ownerInfo.owner.address.line1,city:i.stripe.ownerInfo.owner.address.city,state:i.stripe.ownerInfo.owner.address.state,postal_code:i.stripe.ownerInfo.owner.address.postal_code}},success:function(e){e.error?($(".confirm-wrapper .card-errors").html(e.error),i.stripe.valid):(i.stripe.payment_intent=e,i.stripe.valid=!0,i.fn.stripe_utils.create_stripe_token())},error:function(e){$(".confirm-wrapper .card-errors").html("There was an unexpected error")}})},create_stripe_token:function(){i.stripe.createToken(i.stripe.card).then(function(e){var t,r;(i.stripe.token=e).error?(i.stripe.valid=!1,$(".card-errors").each(function(){$("#confirm-section button#submit").removeClass("spin"),$(this).html(e.error.message)})):(i.stripe.valid=!0,null==e.token&&""==e.token||(t=document.getElementById("payment-form"),(r=document.createElement("input")).setAttribute("type","hidden"),r.setAttribute("name","stripeToken"),r.setAttribute("value",e.token.id),t.appendChild(r),i.fn.stripe_utils.create_stripe_source()))})},create_stripe_source:function(){i.stripe.createSource(i.stripe.card,i.stripe.ownerInfo).then(function(e){var t,r;e.error?(i.stripe.valid=!1,document.getElementById("card-errors").textContent=e.error.message):(i.stripe.valid=!0,t=document.getElementById("payment-form"),(r=document.createElement("input")).setAttribute("type","hidden"),r.setAttribute("name","stripeSource"),r.setAttribute("value",e.source.id),t.appendChild(r),"chargeable"==e.source.status?1==i.fn.stripe_utils.check_goodtogo()&&(i.stripe.valid=!0,i.stripe.chargable=!0,i.fn.stripe_utils.confirm_card_payment()):i.stripe.valid=!1)})},confirm_card_payment:function(){var e=i.stripe.payment_intent.client_secret;i.stripe.confirmCardPayment(e,{payment_method:{card:i.stripe.card},shipping:{name:i.stripe.ownerInfo.owner.name,address:{line1:i.stripe.ownerInfo.owner.address.line1,city:i.stripe.ownerInfo.owner.address.city,state:i.stripe.ownerInfo.owner.address.state,postal_code:i.stripe.ownerInfo.owner.address.postal_code}}}).then(function(e){$("#confirm-section button#submit .spinner").removeClass("spin"),e.error?$(i.stripe.stripeWrapper).find("#confirm-section .card-errors").html("opps there was an error with your transaction"):($("#confirm-section").addClass("hide"),$("#success-wrapper").removeClass("hide"),i.stripe.amount=null,i.stripe.valid="complete",$("#infotab.tab").addClass("disabled"),$("#paymenttab.tab").addClass("disabled"),$("#confirmtab.tab").addClass("disabled"),$(".amount-cell.active").click())})}},stripe:function(){$.getScript("https://js.stripe.com/v3/",function(e,t,r){1==i.vars.use_test_data?i.stripe=Stripe(i.vars.stripe_api_test_key):i.stripe=Stripe(i.vars.stripe_api_live_key),i.stripe.stripeWrapper=$("#stripe-api"),i.stripe.element_obj=i.stripe.elements(),i.stripe.card=i.stripe.element_obj.create("card",{hidePostalCode:!0,style:{base:{iconColor:"#000","font-size":"16px",color:"#000",backgroundColor:"#f7f7f7","::placeholder":{color:"#555"}},invalid:{iconColor:"#ff4f4f",color:"#ff4f4f"}}}),i.stripe.card.mount("#card-element"),$(i.stripe.stripeWrapper).find("input#names").focus(),$("button#submit").click(function(e){e.preventDefault()}),i.stripe.card.on("change",function(e){i.fn.stripe_utils.clear_error(),e.error&&(i.stripe.valid=!1,$(i.stripe.stripeWrapper).find("button#payment").addClass("disabled"),$(i.stripe.stripeWrapper).find("#confirmtab").addClass("disabled"),$("#payment-section .card-errors").html(e.error.message)),e.complete&&($("button#payment").removeClass("disabled"),i.stripe.valid=!0)}),$(i.stripe.stripeWrapper).find("button#submit").on("click",function(e){e.preventDefault(),1!=$(this).hasClass("disabled")&&(i.fn.stripe_utils.get_payment_intents(i.stripe.amount),$("#confirm-section button#submit .spinner").addClass("spin"))}),$(i.stripe.stripeWrapper).find(".amount-cell").on("click",function(){$(i.stripe.stripeWrapper).find(".amount-cell").each(function(){$(this).removeClass("active")});let e=$(this).attr("data-amount");i.fn.stripe_utils.clear_error(),"false"==$(this).attr("data-active")?($(this).addClass("active"),$(this).attr("data-active","true"),$(i.stripe.stripeWrapper).find("input#amount").val(e),$(i.stripe.stripeWrapper).find("div#amount-result").html("$"+e),i.stripe.amount=e,i.stripe.valid=!0):(e=0,$(this).removeClass("active"),$(this).attr("data-active","false"),$(i.stripe.stripeWrapper).find("input#amount").val(e),$(i.stripe.stripeWrapper).find("div#amount-result").html("$"+e),i.stripe.amount=e,i.stripe.valid=!1)}),$(i.stripe.stripeWrapper).find("input#amount").on("focus",function(){$(this).addClass("active"),i.fn.stripe_utils.clear_error()}),$(i.stripe.stripeWrapper).find(" input#amount").on("focusout",function(){$(this).removeClass("active");var e=$(this).val();$(this).val(parseInt(e)),$("div#amount-result").html("$"+e),i.stripe.amount=e}),$(i.stripe.stripeWrapper).find("input#amount").on("input",function(){i.fn.stripe_utils.clear_error(),$(i.stripe.stripeWrapper).find("div#amount-result").html("$"+$(this).val()),0<$(i.stripe.stripeWrapper).find(".amount-cell.active").length&&($(i.stripe.stripeWrapper).find(".amount-cell.active").attr("data-active",!1),$(i.stripe.stripeWrapper).find(".amount-cell.active").removeClass("active"))}),$(i.stripe.stripeWrapper).find(".tab ").on("click",function(){var e;1!=$(this).hasClass("disabled")&&(i.fn.stripe_utils.clear_error(),$(i.stripe.stripeWrapper).find(".tab").each(function(){$(this).removeClass("active")}),$(this).addClass("active"),e=$(this).attr("data-active"),$(".tab-section").each(function(){$(this).addClass("hide")}),$("#"+e).removeClass("hide"))}),$(i.stripe.stripeWrapper).find("button.continue").on("click",function(e){e.preventDefault(),1!=$(this).hasClass("disabled")&&("confirm-section"==(e=$(this).attr("data-next"))&&(i.fn.stripe_utils.check_goodtogo(),i.stripe.unlockconfirm=!0),"form-wrapper"==e?0!=i.fn.stripe_utils.check_amount()&&i.fn.stripe_utils.nav_to_next(this):0!=i.fn.stripe_utils.check_userinfo()&&("confirm-section"==e&&($("#confirm-section button#submit").removeClass("disabled"),$("#confirm-section #cardno").html("Valid"),$(i.stripe.stripeWrapper).find(".confirm-wrapper").find("#name").html(i.stripe.ownerInfo.owner.name),$(i.stripe.stripeWrapper).find(".confirm-wrapper").find("#address").html(i.stripe.ownerInfo.owner.address.line1),$(i.stripe.stripeWrapper).find(".confirm-wrapper").find("#city").html(i.stripe.ownerInfo.owner.address.city),$(i.stripe.stripeWrapper).find(".confirm-wrapper").find("#state").html(i.stripe.ownerInfo.owner.address.state),$(i.stripe.stripeWrapper).find(".confirm-wrapper").find("#zip").html(i.stripe.ownerInfo.owner.address.postal_code),$(i.stripe.stripeWrapper).find(".confirm-wrapper").find("#email").html(i.stripe.ownerInfo.owner.email)),i.fn.stripe_utils.nav_to_next(this)))}),$(i.stripe.stripeWrapper).find("input.info").on("change",function(){var e=$(this).attr("data-result");$(i.stripe.stripWrapper).find("#confirm-section #"+e).text($(this).val()),i.fn.stripe_utils.generate_stripe_data()})})}}}}$(document).ready(function(){const e=new Give;e.fn.init(),php_vars=null});